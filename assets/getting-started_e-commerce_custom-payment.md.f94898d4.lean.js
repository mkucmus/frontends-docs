import{k as s,F as a,$ as e,W as n}from"./chunks/framework.e8799e72.js";import{_ as o}from"./chunks/StackBlitzLiveExample.27a22aa2.js";const l=n('<h1 id="custom-payment-flow-based-on-paypal-express-checkout" tabindex="-1">Custom payment flow based on PayPal Express Checkout <a class="header-anchor" href="#custom-payment-flow-based-on-paypal-express-checkout" aria-label="Permalink to &quot;Custom payment flow based on PayPal Express Checkout&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">Advanced Guide - prior knowledge required</p><p>In order to follow this guide properly, we recommend that you get familiar with the payment flow and payment API concepts first.</p><ul><li><a href="https://developer.shopware.com/docs/concepts/commerce/checkout-concept/payments" target="_blank" rel="noreferrer">Payment Flow in Shopware 6</a></li><li><a href="https://shopware.stoplight.io/docs/store-api/8218801e50fe5-handling-the-payment" target="_blank" rel="noreferrer">Payment API</a></li></ul></div><p>In this chapter you will learn how to integrate a payment flow with Shopware Frontends. There are various ways in which payment providers integrate with Shopware&#39;s API, so it is likely that you need to consult the documentation of your payment provider to get the details.</p><p>This specific guides shows how to integrate the <strong>PayPal Express Checkout</strong>. However, the general flow is the same for all payment providers, so you will be able to use this guide as a reference for different providers.</p><p>Specifically, you will learn how to</p><ul><li>Prepare the Shopware instance for taking PayPal payments</li><li>Embed payment buttons in your frontend</li><li>React on PayPal events to prepare and capture the payment</li></ul><h2 id="install-the-payment-extension" tabindex="-1">Install the payment extension <a class="header-anchor" href="#install-the-payment-extension" aria-label="Permalink to &quot;Install the payment extension&quot;">​</a></h2><p>Payment integrations require communication with the backend for various scenarios</p><ul><li>Create a PayPal order</li><li>Inform PayPal which payment was selected</li><li>Capture the user payment after approval from the provider</li><li>Update the order status</li><li>Notify customers on successful/failed payment</li><li>Other actions that need additional credentials which should stay hidden (i.e. secret authorization tokens)</li></ul><p>That&#39;s why the backend as a Payment middleware is a good option to store additional information, credentials, react on events and so on.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Make sure that the Payment Provider you would like to install, provides also an interface to interact via Store-API for headless solutions, specially when it&#39;s a synchronous payment flow.</p></div><p>The <a href="https://github.com/shopwareLabs/SwagPayPal" target="_blank" rel="noreferrer">SwagPayPal</a> extension is available on Shopware Cloud stores and also can be installed manually in self-managed instances. It provides useful endpoints to conduct payments with PayPal. We will be using two PayPal-specific endpoints in this guide:</p><h3 id="create-order" tabindex="-1">Create order <a class="header-anchor" href="#create-order" aria-label="Permalink to &quot;Create order&quot;">​</a></h3><p><code>/store-api/paypal/express/create-order</code></p><ul><li>Creates an order directly with PayPal which contains information about the cart and the user</li><li>Returns a payment intent token that identifies the order in PayPal</li></ul><h3 id="prepare-checkout" tabindex="-1">Prepare checkout <a class="header-anchor" href="#prepare-checkout" aria-label="Permalink to &quot;Prepare checkout&quot;">​</a></h3><p><code>/store-api/paypal/express/prepare-checkout</code></p><ul><li>Used after PayPal approved the payment process request</li><li>Registers a customer based on PayPal account&#39;s data (name, address, email) and logs them in</li><li>The API Client receives a new context token that points to the logged-in customer</li></ul><h2 id="embed-express-payment-buttons" tabindex="-1">Embed Express Payment buttons <a class="header-anchor" href="#embed-express-payment-buttons" aria-label="Permalink to &quot;Embed Express Payment buttons&quot;">​</a></h2><p>The next step is to embed the PayPal Express Checkout buttons in your frontend using the PayPal Javascript SDK. The SDK can be loaded from the PayPal CDN or using an npm package (<a href="https://developer.paypal.com/sdk/js/configuration/" target="_blank" rel="noreferrer">PayPal SDK Documentation</a>). In our example we&#39;re going to use the second option.</p><h3 id="load-the-paypal-sdk" tabindex="-1">Load the PayPal SDK <a class="header-anchor" href="#load-the-paypal-sdk" aria-label="Permalink to &quot;Load the PayPal SDK&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">Client only</p><p>The PayPal SDK and all its methods should only be invoked on client side rendered pages.</p></div><p>In a Vue component we can use the <code>loadScript</code> method from the <a href="https://www.npmjs.com/package/@paypal/paypal-js" target="_blank" rel="noreferrer"><code>@paypal/paypal-js</code></a> npm package:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">loadScript</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@paypal/paypal-js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#82AAFF;">loadScript</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// client id is generated in the PayPal account&#39;s apps section</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">client-id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">AUAcLFoadrmy9JiW2cHgriy1mTy0MCqQOP_1SSeQEUArz_zPeF1VcNY2CCxcFBQpf_N4g1k5wFVNJ1Bk</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">currency</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EUR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// or use some reference to the current currency</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">locale</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en_US</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// as same as in the field above</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"></span></code></pre></div><p>Now, the <code>paypal</code> object will be available in the global <code>window</code> object.</p><h3 id="register-the-buttons" tabindex="-1">Register the buttons <a class="header-anchor" href="#register-the-buttons" aria-label="Permalink to &quot;Register the buttons&quot;">​</a></h3><p>In order to display a PayPal Button component, we need to mount it in the DOM.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// client only</span></span>\n<span class="line"><span style="color:#A6ACCD;">window</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">paypal</span><span style="color:#89DDFF;">?</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Buttons</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#676E95;font-style:italic;">/** configuration skipped */</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#paypal-buttons-container</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">// this script will mount the component in element with id=&quot;paypal-buttons-container&quot;</span></span>\n<span class="line"></span></code></pre></div><h2 id="react-on-paypal-events" tabindex="-1">React on PayPal events <a class="header-anchor" href="#react-on-paypal-events" aria-label="Permalink to &quot;React on PayPal events&quot;">​</a></h2><p>Now, that the buttons are properly displayed, we need to react to two basic events.</p><ul><li><code>createOrder</code></li><li><code>onApprove</code></li></ul><p>There are additional events like <code>onInit</code>, <code>onCancel</code> or <code>onError</code> (and more) to be used on specific cases, which we are not going to cover in this guide.</p><h3 id="createorder-event" tabindex="-1"><code>createOrder</code> event <a class="header-anchor" href="#createorder-event" aria-label="Permalink to &quot;`createOrder` event&quot;">​</a></h3><p>In the <code>creatOrder</code> callback, you need to prepare the PayPal order and return a token that identifies the order in PayPal. This token will be used later on to capture the payment. It is called when the user clicks on the PayPal express checkout button.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// client only</span></span>\n<span class="line"><span style="color:#A6ACCD;">window</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">paypal</span><span style="color:#89DDFF;">?</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Buttons</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">createOrder</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CreateOrderData</span><span style="color:#89DDFF;">,</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">actions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CreateOrderActions</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">      ) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line highlighted"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setPaymentMethod</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">paypalMethod</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>\n<span class="line highlighted"></span>\n<span class="line highlighted"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">addToCart</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>\n<span class="line highlighted"></span>\n<span class="line highlighted"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">apiInstance</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">invoke</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">&lt;{</span><span style="color:#F07178;"> token</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}&gt;</span><span style="color:#F07178;">(</span></span>\n<span class="line highlighted"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/store-api/paypal/express/create-order</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line highlighted"><span style="color:#F07178;">        )</span><span style="color:#89DDFF;">;</span></span>\n<span class="line highlighted"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">token</span><span style="color:#89DDFF;">;</span></span>\n<span class="line highlighted"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#paypal-buttons-container</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line highlighted"></span></code></pre></div><p>The approach here is to set the payment method internally, then add a current product to the cart, and then prepare a PayPal token to be used later on.</p><p>In the example above we do a couple of things:</p><ol><li>Set the payment method for the current context</li><li>Add a product to the cart</li><li>Create a PayPal order and return the token</li></ol><h3 id="onapprove-event" tabindex="-1"><code>onApprove</code> event <a class="header-anchor" href="#onapprove-event" aria-label="Permalink to &quot;`onApprove` event&quot;">​</a></h3><p>This event is called when the user approves the payment process. It&#39;s the last step before the payment is captured.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre><code><span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// part of window.paypal.Buttons({}) params</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">onApprove</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OnApproveData</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">actions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OnApproveActions</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">apiInstance</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">invoke</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#F07178;">(</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/store-api/paypal/express/prepare-checkout</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#F07178;">        token</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">orderID</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>\n<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// createOrder from useCheckout composable</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">orderCreated</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createOrder</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">refreshCart</span><span style="color:#F07178;">()</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// apiInstance from useShopwareContext composable</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handlePaymentResponse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">apiInstance</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">invoke</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#F07178;">(</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/store-api/handle-payment</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#F07178;">        orderId</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">orderCreated</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#F07178;">        successUrl</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`${</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">origin</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/order/success?order=</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">orderCreated</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&amp;success=true</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#F07178;">        errorUrl</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`${</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">origin</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/order/success?order=</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">orderCreated</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&amp;success=false</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;">,</span></span>\n<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>\n<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">redirectPaymentUrl</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handlePaymentResponse</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">redirectUrl</span><span style="color:#89DDFF;">;</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//</span></span>\n<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span></span>\n<span class="line"></span></code></pre></div><p>The example above shows the code that is executed after a payer approves the PayPal popup. This function calls the <code>prepare-checkout</code> endpoint to register the upcoming PayPal transaction.</p><div class="tip custom-block"><p class="custom-block-title">Call custom endpoints</p><p>You can call custom endpoints using the <code>apiInstance.invoke.post()</code>, <code>.get()</code>, <code>.put()</code> or <code>.delete()</code> methods. They will automatically add the <code>sw-context-token</code> header to authenticate the request.</p></div><p>Thanks to the internal logic of the PayPal extension, the is already connected with the logged in customer. Now you can call <code>createOrder()</code> which creates an order through the Store-API. Once the order is created, its <code>id</code> can be used to invoke the <code>handle-payment</code> action to process payment. This action captures the money or redirects the user to an external payment gateway.</p><h2 id="working-example" tabindex="-1">Working example <a class="header-anchor" href="#working-example" aria-label="Permalink to &quot;Working example&quot;">​</a></h2><p>The example shows the specific case, when a product can be bought in one action from the frontend.</p>',46),t=JSON.parse('{"title":"Custom payment flow based on PayPal Express Checkout","description":"","frontmatter":{"head":[["meta",{"name":"og:title","content":"Custom payment"}],["meta",{"name":"og:description","content":"In this chapter you will learn how to implement a custom payment flow based on PayPal Express Checkout."}],["meta",{"name":"og:image","content":"https://frontends-og-image.vercel.app/Custom%20**Payment**%20Process.png"}]]},"headers":[{"level":2,"title":"Install the payment extension","slug":"install-the-payment-extension","link":"#install-the-payment-extension","children":[{"level":3,"title":"Create order","slug":"create-order","link":"#create-order","children":[]},{"level":3,"title":"Prepare checkout","slug":"prepare-checkout","link":"#prepare-checkout","children":[]}]},{"level":2,"title":"Embed Express Payment buttons","slug":"embed-express-payment-buttons","link":"#embed-express-payment-buttons","children":[{"level":3,"title":"Load the PayPal SDK","slug":"load-the-paypal-sdk","link":"#load-the-paypal-sdk","children":[]},{"level":3,"title":"Register the buttons","slug":"register-the-buttons","link":"#register-the-buttons","children":[]}]},{"level":2,"title":"React on PayPal events","slug":"react-on-paypal-events","link":"#react-on-paypal-events","children":[{"level":3,"title":"createOrder event","slug":"createorder-event","link":"#createorder-event","children":[]},{"level":3,"title":"onApprove event","slug":"onapprove-event","link":"#onapprove-event","children":[]}]},{"level":2,"title":"Working example","slug":"working-example","link":"#working-example","children":[]}],"relativePath":"getting-started/e-commerce/custom-payment.md","filePath":"getting-started/e-commerce/custom-payment.md"}'),p={name:"getting-started/e-commerce/custom-payment.md"},r=Object.assign(p,{setup:n=>(n,t)=>(s(),a("div",null,[l,e(o,{projectPath:"shopware/frontends/tree/main/examples/express-checkout",openPath:"/"})]))});export{t as __pageData,r as default};
